<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Mini RPG con Elementos y Registro de Batalla</title>
<style>
/* Estilos del Body: Base y Posicionamiento */
body{
    font-family:Arial,sans-serif;
    color:#fff;
    margin:0;
    display:flex;
    justify-content:center;
    align-items:flex-start;
    padding-top:10vh;
    
    min-height: 100vh;
    width: 100vw;
    transition: background 0.5s ease-in-out;
}

/* Fondos especÃ­ficos para las fases del juego */
.setup-bg {
    background: url('ImagenCreacion.jpg') center center / cover no-repeat fixed;
}
.game-bg {
    background: url('ImagenFondo.jpg') center center / cover no-repeat fixed;
}

/* Contenedor principal del juego */
.container{
    width:900px;
    text-align:center;
    background: rgba(0, 0, 0, 0.7);
    padding: 20px;
    border-radius: 10px;
    z-index: 10;
    position: relative;
}

/* ------------------------------------------------------------------ */
/* ESTILOS DE BOTONES (GENERAL) Y HOVER DE COMBATE */
/* ------------------------------------------------------------------ */

button{
    padding:10px 16px;
    margin:5px;
    border:none;
    border-radius:6px;
    cursor:pointer;
    background: #3b82f6;
    color: white;
    font-weight: bold;
    transition: background 0.2s, transform 0.2s, box-shadow 0.2s;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.4);
}

button:hover {
    background: #2563eb;
    transform: translateY(-1px);
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.6);
}

button[onclick="resetGame()"] {
    background: #4a5568;
}

button[onclick="resetGame()"]:hover {
    background: #2d3748;
}

input[type=text]{
    padding:6px;
    font-size:16px;
    border-radius:4px;
    border:none;
    width:200px;
    margin-bottom:10px;
}

/* Contenedores de Personajes y CPU */
.character, .cpu{
    display:inline-block;
    width:150px;
    height:150px;
    background:#3f4b64;
    border-radius:50%;
    margin:10px;
    position:relative; /* Mantenemos relative por si hace falta para otros efectos */
    box-shadow: 0 4px 10px rgba(0,0,0,0.5);
    overflow: hidden; 
}
.character img, .cpu img {
    width: 100%;
    height: 100%;
    object-fit: cover; 
    border-radius: 50%;
}

.attackEffect{
    position:absolute;
    font-size:50px;
    animation:hit 0.7s ease;
    top:50%;
    left:50%;
    transform:translate(-50%,-50%);
    z-index: 10;
}

@keyframes hit{
    0%{transform:translate(-50%,-50%) scale(0.2); opacity:0;}
    50%{transform:translate(-50%,-50%) scale(1.6); opacity:1;}
    100%{transform:translate(-50%,-50%) scale(0.8); opacity:0;}
}

.hidden{display:none;}

#battleLog{
    margin-top:20px; 
    text-align:left; 
    max-height:200px; 
    overflow-y:auto; 
    background:#222; 
    padding:10px; 
    border-radius:6px;
    width:90%;
    margin: 20px auto 0;
    font-size: 14px;
}
.log-entry.win { color: #84cc16; }
.log-entry.lose { color: #f87171; }
.log-entry.draw { color: #94a3b8; }
.log-entry strong { color: white; }

/* ------------------------------------------------------------------ */
/* ESTILOS DE LA BARRA DE VIDA (AHORA EN FLUJO NORMAL) */
/* ------------------------------------------------------------------ */

.hp { 
    display: none; 
} 

/* Contenedor de la barra de vida */
.hp-bar-container {
    /* Ya no es absoluto; se posiciona justo antes del div del personaje */
    margin: 0 auto 5px; /* Centrado y con espacio inferior */
    width: 120px; 
    height: 18px;
    background: #000; 
    border: 2px solid #fff;
    border-radius: 4px;
    box-shadow: 0 0 5px rgba(0, 0, 0, 0.7);
    z-index: 20;
    /* Aseguramos que se comporte como un bloque centrado */
    display: block; 
}

/* Relleno de la barra de vida */
.hp-bar-fill {
    height: 100%;
    width: 100%; 
    background: #4CAF50;
    border-radius: 2px;
    transition: width 0.5s ease-out, background-color 0.5s ease;
    position: relative;
}

/* Texto de la vida (ej: 10/10) */
.hp-text {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: white;
    font-size: 11px;
    font-weight: bold;
    text-shadow: 1px 1px 2px black;
    z-index: 21; 
}


/* ------------------------------------------------------------------ */
/* ESTILOS PARA LA SELECCIÃ“N DE ELEMENTOS (SETUP - CHECKBOXES) */
/* ------------------------------------------------------------------ */

.setup-elements {
    background: #2d3748;
    padding: 15px;
    border-radius: 8px;
    margin-bottom: 15px;
}

/* Estilo general para la etiqueta (el botÃ³n) */
.element-btn {
    margin: 5px;
    display: inline-block;
    cursor: pointer;
}

/* Ocultar el checkbox nativo */
.element-btn input[type="checkbox"] {
    display: none;
}

/* Estilo para el texto (la cara visible del botÃ³n) */
.element-btn span {
    padding: 10px 15px;
    background: #3f4b64;
    border-radius: 6px;
    display: inline-block;
    border: 2px solid #4a5568;
    font-weight: bold;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.4);
    transition: background 0.2s, border 0.2s, transform 0.2s, box-shadow 0.2s;
}

/* EFECTO HOVER: Sombra mÃ¡s pronunciada y escala */
.element-btn span:hover {
    transform: scale(1.05);
    box-shadow: 0 4px 10px rgba(59, 130, 246, 0.8);
    cursor: pointer;
}

/* Estilo cuando el checkbox asociado estÃ¡ seleccionado */
.element-btn input[type="checkbox"]:checked + span {
    background: #3b82f6;
    border-color: #ffffff;
    transform: scale(1.02);
}


/* ------------------------------------------------------------------ */
/* ESTILOS PARA LAS CARTAS DE SELECCIÃ“N EN COMBATE (#gameArea) */
/* ------------------------------------------------------------------ */

.card-area {
    margin: 20px auto 10px;
    background: #2d3748;
    padding: 15px;
    border-radius: 8px;
    text-align: center;
}

.element-card {
    min-width: 100px;
    padding: 15px 10px;
    margin: 8px;
    background: #3f4b64;
    color: white;
    border: 2px solid #4a5568;
    border-radius: 6px;
    font-weight: bold;
    cursor: pointer;
    transition: background 0.2s, border 0.2s, transform 0.2s;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.4);
}

.element-card:hover {
    transform: translateY(-2px);
    background: #4a5568;
}

.element-card.selected {
    background: #3b82f6;
    border-color: #ffffff;
    transform: scale(1.05);
    box-shadow: 0 6px 12px rgba(59, 130, 246, 0.8);
}


/* Otros estilos para el juego */
.elemental-effect {
    font-size: 11px;
    font-weight: bold;
}
.super-effective { color: #84cc16; }
.not-effective { color: #f87171; }
.normal-effective { color: #94a3b8; }

</style>
</head>

<body class="setup-bg"> 
<div class="container">

<div id="setup">
    <h2>Crea tu personaje (5 Elementos disponibles)</h2>
    <input type="text" id="playerName" placeholder="Nombre de tu personaje"><br>

    <div class="setup-elements">
        <strong>Elige 3 ataques:</strong><br>
        <label class="element-btn"><input type="checkbox" class="atk" value="Fuego"> <span>Fuego ðŸ”¥</span></label>
        <label class="element-btn"><input type="checkbox" class="atk" value="Agua"> <span>Agua ðŸ’§</span></label>
        <label class="element-btn"><input type="checkbox" class="atk" value="Tierra"> <span>Tierra ðŸª¨</span></label>
        <label class="element-btn"><input type="checkbox" class="atk" value="Electricidad"> <span>Electricidad âš¡</span></label>
        <label class="element-btn"><input type="checkbox" class="atk" value="Viento"> <span>Viento ðŸ’¨</span></label>
    </div>

    <div class="setup-elements">
        <strong>Elige 3 defensas:</strong><br>
        <label class="element-btn"><input type="checkbox" class="def" value="Escudo Fuego"> <span>Escudo Fuego</span></label>
        <label class="element-btn"><input type="checkbox" class="def" value="Escudo Agua"> <span>Escudo Agua</span></label>
        <label class="element-btn"><input type="checkbox" class="def" value="Escudo Tierra"> <span>Escudo Tierra</span></label>
        <label class="element-btn"><input type="checkbox" class="def" value="Escudo Electricidad"> <span>Escudo Electricidad</span></label>
        <label class="element-btn"><input type="checkbox" class="def" value="Escudo Viento"> <span>Escudo Viento</span></label>
    </div>

    <button onclick="startGame()">Comenzar</button>
</div>

<div id="gameArea" class="hidden">
    <h2 id="title"></h2>
    <div style="display: flex; justify-content: center; align-items: center;">
        
        <div id="player-group" style="text-align: center; margin: 0 20px;">
            <div class="hp-bar-container" id="playerHPContainer">
                <div class="hp-bar-fill">
                    <div class="hp-text">10/10</div>
                </div>
            </div>
            <div class="character" id="playerChar">
                <img src="ImagenPersonaje.jpg" alt="Tu Personaje">
            </div>
        </div>

        <h3 style="margin: 0 20px;">VS</h3>
        
        <div id="cpu-group" style="text-align: center; margin: 0 20px;">
            <div class="hp-bar-container" id="cpuHPContainer">
                <div class="hp-bar-fill">
                    <div class="hp-text">10/10</div>
                </div>
            </div>
            <div class="character cpu" id="cpuChar">
                <img src="ImagenContrincante.jpg" alt="Contrincante">
            </div>
        </div>
    </div>

    <div style="margin-top:20px;">
        
        <div class="card-area">
            <p style="font-weight: bold; margin: 0 0 10px;">Selecciona Ataque (Elemento)</p>
            <div id="attackCardArea">
                </div>
        </div>

        <div class="card-area">
            <p style="font-weight: bold; margin: 0 0 10px;">Selecciona Defensa (Escudo)</p>
            <div id="defenseCardArea">
                </div>
        </div>
        
        <div style="margin-top:20px;">
            <button onclick="play('Ataque Fuerte')">ðŸ’¥ Ataque Fuerte</button>
            <button onclick="play('Contraataque')">ðŸŒ€ Contraataque</button>
            <button onclick="play('Bloqueo')">ðŸ›¡ Bloqueo</button>
        </div>
        <button onclick="resetGame()" style="margin-top: 10px;">ðŸ”„ Reiniciar Juego</button>
    </div>

    <div id="battleLog">
        <h3>Registro de batalla:</h3>
        <div id="logContent"></div>
    </div>

</div>

</div>

<script>
const MAX_HP = 10;
let playerHP = MAX_HP;
let cpuHP = MAX_HP;
let running = true;

let playerName = "";
let atkSelection = [];
let defSelection = [];

let selectedAttack = null; 
let selectedDefense = null; 

const cpuAtkOptions = ["Fuego", "Agua", "Tierra", "Electricidad", "Viento"];
const cpuDefOptions = ["Escudo Fuego", "Escudo Agua", "Escudo Tierra", "Escudo Electricidad", "Escudo Viento"];

const titleEl = document.getElementById("title");
const logContent = document.getElementById("logContent");

const beats = {
    "Ataque Fuerte": "Bloqueo",
    "Bloqueo": "Contraataque",
    "Contraataque": "Ataque Fuerte"
};

const elementalStrengths = {
    "Agua":         { weakTo: "Electricidad", strongAgainst: ["Fuego"] },
    "Fuego":        { weakTo: "Agua", strongAgainst: ["Viento"] },
    "Viento":       { weakTo: "Fuego", strongAgainst: ["Tierra"] },
    "Tierra":       { weakTo: "Viento", strongAgainst: ["Electricidad"] },
    "Electricidad": { weakTo: "Tierra", strongAgainst: ["Agua"] }
};

function getRandomElement(list) {
    return list[Math.floor(Math.random() * list.length)];
}

function checkElementSelection(selector, count) {
    return Array.from(document.querySelectorAll(selector + ':checked')).length === count;
}


function selectCard(clickedButton, elementValue, type) {
    const allCardsOfType = document.querySelectorAll(`.${type}-card`);

    allCardsOfType.forEach(btn => btn.classList.remove('selected'));
    clickedButton.classList.add('selected');

    if (type === 'attack') {
        selectedAttack = elementValue;
    } else {
        selectedDefense = elementValue;
    }
}

// CORRECCIÃ“N: Usamos los nuevos IDs de contenedores (playerHPContainer/cpuHPContainer)
function updateHPDisplay(idPrefix, currentHP) {
    const fillEl = document.querySelector(`#${idPrefix}HPContainer .hp-bar-fill`);
    const textEl = document.querySelector(`#${idPrefix}HPContainer .hp-text`);
    
    if (!fillEl || !textEl) return; // ValidaciÃ³n extra

    const percentage = (currentHP / MAX_HP) * 100;
    
    fillEl.style.width = percentage + '%';
    textEl.innerText = `${currentHP}/${MAX_HP}`;

    if (percentage > 50) {
        fillEl.style.backgroundColor = '#4CAF50';
    } else if (percentage > 20) {
        fillEl.style.backgroundColor = '#FFC107';
    } else {
        fillEl.style.backgroundColor = '#F44336';
    }
}


function startGame(){
    playerName = document.getElementById("playerName").value || "Jugador";
    atkSelection = Array.from(document.querySelectorAll(".atk:checked")).map(c=>c.value);
    defSelection = Array.from(document.querySelectorAll(".def:checked")).map(c=>c.value);

    if(!checkElementSelection(".atk", 3) || !checkElementSelection(".def", 3)){
        alert("Debes seleccionar exactamente 3 elementos de ataque y 3 de defensa.");
        return;
    }
    
    document.body.classList.remove('setup-bg');
    document.body.classList.add('game-bg');

    const attackArea = document.getElementById("attackCardArea");
    const defenseArea = document.getElementById("defenseCardArea");

    attackArea.innerHTML = "";
    defenseArea.innerHTML = "";

    atkSelection.forEach(element => {
        const btn = document.createElement("button");
        btn.innerText = element;
        btn.className = "element-card attack-card";
        btn.onclick = () => selectCard(btn, element, 'attack'); 
        attackArea.appendChild(btn);
    });

    defSelection.forEach(element => {
        const btn = document.createElement("button");
        btn.innerText = element;
        btn.className = "element-card defense-card";
        btn.onclick = () => selectCard(btn, element, 'defense');
        defenseArea.appendChild(btn);
    });

    selectedAttack = null;
    selectedDefense = null;


    document.getElementById("setup").classList.add("hidden");
    document.getElementById("gameArea").classList.remove("hidden");

    titleEl.innerText = `Â¡${playerName} VS MÃ¡quina!`;
    logContent.innerHTML="";
    running = true;
    
    // Inicializar barras de vida al 100% (Usamos los prefijos 'player' y 'cpu')
    updateHPDisplay('player', playerHP); 
    updateHPDisplay('cpu', cpuHP); 
}

function cpuPickMove(){
    const options = Object.keys(beats);
    return options[Math.floor(Math.random()*3)];
}

function showEffect(icon){
    const el = document.createElement("div");
    el.className = "attackEffect";
    el.innerText = icon;
    document.body.appendChild(el);
    setTimeout(()=>el.remove(),700);
}

function getElementalEffectText(mod) {
    if (mod > 0) return '<span class="super-effective elemental-effect">Â¡Super Efectivo!</span>';
    if (mod < 0) return '<span class="not-effective elemental-effect">No Efectivo.</span>';
    return '<span class="normal-effective elemental-effect">DaÃ±o normal.</span>';
}

function logTurn(action, atkChoice, defChoice, cpuChoice, cpuAtk, cpuDef, result, pDmg, cDmg, pEff, cEff){
    const div = document.createElement("div");
    let cls = 'draw';
    
    if (cDmg > 0 && pDmg == 0) cls = 'win';
    else if (pDmg > 0 && cDmg == 0) cls = 'lose';
    
    div.className = `log-entry ${cls}`;
    
    let actionText = `
        <strong>Turno:</strong> 
        ${playerName}: ${action} (${atkChoice} / ${defChoice.replace('Escudo ', 'S-')}) | 
        CPU: ${cpuChoice} (${cpuAtk} / ${cpuDef.replace('Escudo ', 'S-')})
        <br>
    `;

    let damageDetails = '';
    if (cDmg > 0) {
        damageDetails += `<span class="win">${playerName} daÃ±a a CPU: -${cDmg} HP.</span> ${pEff || ''}`;
    }
    if (pDmg > 0) {
        if (cDmg > 0) damageDetails += ' | ';
        damageDetails += `<span class="lose">CPU daÃ±a a ${playerName}: -${pDmg} HP.</span> ${cEff || ''}`;
    }

    if (!damageDetails) {
        damageDetails = 'Resultado: Empate sin daÃ±o. ' + result;
    } else {
        damageDetails = `Resultado: ${result}. ${damageDetails}`;
    }

    div.innerHTML = actionText + damageDetails;
    logContent.prepend(div);
    logContent.scrollTop = 0;
}

function calculateElementalMod(attackerElement, defenderShield) {
    let modifier = 0;
    
    if (!attackerElement) return 0;

    const atkData = elementalStrengths[attackerElement];
    
    if (atkData) {
        const defenderElement = defenderShield.split(" ")[1] || defenderShield; 
        
        if (atkData.strongAgainst.includes(defenderElement)) {
            modifier += 1;
        }
        
        if (atkData.weakTo === defenderElement) {
            modifier -= 1;
        }
    }
    
    return modifier;
}


function play(action){
    if(!running) return;

    const pAtkChoice = selectedAttack;
    const pDefChoice = selectedDefense;
    
    if(!pAtkChoice || !pDefChoice){
        alert("Debes seleccionar una carta de ataque y una de defensa para jugar.");
        return;
    }
    
    const cpuChoice = cpuPickMove();
    const cpuAtk = getRandomElement(cpuAtkOptions);
    const cpuDef = getRandomElement(cpuDefOptions);

    const icons = {"Ataque Fuerte":"ðŸ’¥","Contraataque":"ðŸŒ€","Bloqueo":"ðŸ›¡"};
    showEffect(icons[action]);

    let resultText = "";
    let pDmg = 0;
    let cDmg = 0;
    
    let pElementalText = '';
    let cElementalText = '';

    if(action===cpuChoice){
        resultText = "Empate de movimiento";
        
        const pElementalMod = calculateElementalMod(pAtkChoice, cpuDef);
        cDmg = Math.max(0, 1 + pElementalMod);
        pElementalText = getElementalEffectText(pElementalMod);

        const cpuElementalMod = calculateElementalMod(cpuAtk, pDefChoice); 
        pDmg = Math.max(0, 1 + cpuElementalMod);
        cElementalText = getElementalEffectText(cpuElementalMod);

    } else if(beats[action]===cpuChoice){
        resultText = `${playerName} gana el movimiento`;
        
        const pElementalMod = calculateElementalMod(pAtkChoice, cpuDef);
        cDmg = Math.max(0, 1 + pElementalMod);
        pElementalText = getElementalEffectText(pElementalMod);
        
        pDmg = 0;

    }else{
        resultText = `CPU gana el movimiento`;

        const cpuElementalMod = calculateElementalMod(cpuAtk, pDefChoice); 
        pDmg = Math.max(0, 1 + cpuElementalMod);
        cElementalText = getElementalEffectText(cpuElementalMod);

        cDmg = 0;
    }
    
    cpuHP -= cDmg;
    playerHP -= pDmg;
    
    if (cDmg > 0) flash("cpuChar");
    if (pDmg > 0) flash("playerChar");

    playerHP = Math.max(0, playerHP);
    cpuHP = Math.max(0, cpuHP);


    // Actualizar barras de vida y texto numÃ©rico (Usamos los prefijos 'player' y 'cpu')
    updateHPDisplay('player', playerHP); 
    updateHPDisplay('cpu', cpuHP); 

    logTurn(action, pAtkChoice, pDefChoice, cpuChoice, cpuAtk, cpuDef, resultText, pDmg, cDmg, pElementalText, cElementalText);
    
    checkGameOver();
}

function flash(id){
    const el = document.getElementById(id);
    el.style.transition="0.3s";
    el.style.transform="scale(1.2)";
    el.style.background="#8b1e23";
    setTimeout(()=>{
        el.style.transform="scale(1)";
        el.style.background="#3f4b64";
    },300);
}

function checkGameOver(){
    if(playerHP<=0 || cpuHP<=0){
        running=false;
        if(playerHP>0 && cpuHP<=0) alert("Â¡Ganaste la partida!");
        else if(cpuHP>0 && playerHP<=0) alert("Â¡Perdiste la partida!");
        else alert("Â¡Doble KO! Empate final.");
    }
}

function resetGame(){
    if (!confirm("Â¿EstÃ¡s seguro de que quieres reiniciar el juego? Se perderÃ¡ todo el progreso actual de la partida.")) {
        return;
    }
    
    playerHP=MAX_HP;
    cpuHP=MAX_HP;
    running=false;
    
    selectedAttack = null;
    selectedDefense = null;
    
    document.getElementById("gameArea").classList.add("hidden");
    document.getElementById("setup").classList.remove("hidden");
    logContent.innerHTML="";
    
    document.body.classList.remove('game-bg');
    document.body.classList.add('setup-bg');
    
    document.querySelectorAll('.element-card').forEach(btn => btn.classList.remove('selected'));
}

document.addEventListener('DOMContentLoaded', () => {
    const atkCheckboxes = document.querySelectorAll('.atk');
    const defCheckboxes = document.querySelectorAll('.def');

    function handleCheckboxLimit(checkboxes) {
        checkboxes.forEach(cb => {
            cb.addEventListener('change', () => {
                const checkedCount = Array.from(checkboxes).filter(c => c.checked).length;
                if (checkedCount > 3) {
                    cb.checked = false;
                    alert("Solo puedes seleccionar 3 elementos.");
                }
                }
            );
        }
    );
    }
    
    handleCheckboxLimit(atkCheckboxes);
    handleCheckboxLimit(defCheckboxes);
});
</script>

</body>
</html>